<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User">

<resultMap id="tradeMap" type="TradeDTO">
    <id property="tradeIdx" column="tradeIdx"/>
    <result property="purchaseUserIdx" column="purchaseUserIdx"/>
    <result property="salesDate" column="salesDate"/>
    <association property="productDTO" javaType="ProductDTO">
        <id property="productIdx" column="productIdx"/>
        <result property="userIdx" column="userIdx"/>
        <result property="userId" column="userId"/>
        <result property="productTitle" column="productTitle"/>
        <result property="productDescription" column="productDescription"/>
        <result property="productImage" column="productImage"/>
        <result property="productDealType" column="productDealType"/>
        <result property="productPrice" column="productPrice"/>
        <result property="productLocation" column="productLocation"/>
        <result property="productRegisterDate" column="productRegisterDate"/>
        <result property="productInterestCount" column="productInterestCount"/>
        <result property="productChatCount" column="productChatCount"/>
        <result property="categoryIdx" column="categoryIdx"/>
    </association>
</resultMap>


	<select id="checkId" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM `USER` WHERE userId = #{userId}
	</select>

	<insert id="join" parameterType="userdto">
		INSERT INTO `USER` VALUES
		(null,#{userId},#{userPw},#{userName},#{userAge},#{userGender},#{userPhoneNumber},#{userEmail},#{userAddress})
	</insert>

	<select id="login" parameterType="hashmap" resultType="userdto">
		select * from `USER`
		where userId = #{userId} and userPw = #{userPw}
	</select>

	<select id="searchById" parameterType="string" resultType="userdto">
		SELECT * FROM `USER` WHERE userId = #{userId}
	</select>

	<select id="getList" resultType="userdto">
		SELECT * FROM `USER`
	</select>

	<update id="updateAddress" parameterType="hashmap">
		UPDATE `USER`
		SET userAddress = #{userAddress}
		WHERE userId = #{userId}
	</update>

	<select id="getUserId" parameterType="_int" resultType="string">
		select userId from 'USER' where userIdx=#{userIdx}
	</select>

 
	<select id="getPurchaseList" parameterType="_int" resultMap="tradeMap">
    SELECT t.tradeIdx, t.purchaseUserIdx, t.salesDate, p.productIdx, p.* 
    FROM TRADE t
    JOIN PRODUCT p ON t.productIdx = p.productIdx
    WHERE t.purchaseUserIdx = #{userIdx}
	</select>
	
	
	<select id="getSalesList" parameterType="_int" resultMap="tradeMap">
    SELECT t.tradeIdx, t.purchaseUserIdx, t.salesDate, p.productIdx, p.* 
    FROM TRADE t
    JOIN PRODUCT p ON t.productIdx = p.productIdx
    WHERE p.userIdx = #{userIdx}
</select>
	
<!-- 	get profile List? -->
</mapper>
 