<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Product">

	<!-- 물품등록 -->
	<insert id="register" parameterType="productdto">
		INSERT INTO `PRODUCT` VALUES
		(null,#{userIdx},#{userId},#{productTitle},#{productDescription},#{productImage},#{productDealType},#{productPrice},null,now(),0,0,#{categoryIdx},null,null,null)
	</insert>

<!-- 	카테고리로 물품 검색 -->
	<select id="selectProductsByCategoryIdx" parameterType="_int" resultType="productdto">
	SELECT * FROM `PRODUCT` WHERE categoryIdx = #{categoryIdx}
	</select>

	<!-- 물품 상세정보 보기 -->
	<select id="viewProductDetail" parameterType="_int"
		resultType="productdto">
		select * from `PRODUCT` where productIdx = #{productIdx}
	</select>

	<!-- 물품 전체 리스트 가져오기(페이징처리) -->
	<select id="getList" parameterType="hashmap"
		resultType="productdto">
		SELECT * FROM `PRODUCT`
		ORDER BY productIdx DESC
		LIMIT
		#{startRow}, #{pageSize}
	</select>

	<!-- 물품 총 갯수 가져오기 -->
	<select id="getProductCnt" resultType="_int">
		SELECT COUNT(`productIdx`)
		FROM `PRODUCT`
	</select>

	<!-- 구매하기 -->
	<update id="purchase" parameterType="hashmap">
		UPDATE PRODUCT
		SET
		purchaseUserIdx = #{userIdx},
		productSellDate = now()
		where productIdx =
		#{productIdx}
	</update>
	
	<update id="purchase2" parameterType="hashmap">
		UPDATE USER
		SET
		userAccount = userAccount - #{productPrice}
		WHERE userIdx = #{userIdx}
	</update>

		

	<!-- 구매하기 -->
	<update id="sell" parameterType="hashmap">
		UPDATE USER
		SET
		userAccount = userAccount + #{productPrice}
		WHERE userIdx = #{sellUserIdx}
	</update>




	<!-- 물품 가격 가져오기 -->
	<select id="getProductPrice" parameterType="_int"
		resultType="_int">
		select productPrice
		FROM PRODUCT
		WHERE productIdx = #{productIdx}
	</select>

	<select id="getUserIdx" parameterType="_int" resultType="_int">
		select userIdx
		FROM PRODUCT
		WHERE productIdx = #{productIdx}
	</select>

	<!-- 물품 관심 수 가져오기(수정필요) -->
	<!-- <select id="getInterestCount" parameterType = "_int" resultType = "_int"> -->
	<!-- select productInterestCount from `PRODUCT` where productIdx= #{productIdx} -->
	<!-- </select> -->

	<!-- 물품 관심 수 갱신하기(수정필요) -->
	<!-- <update id="updateInterestCount" parameterType="string"> -->
	<!-- UPDATE PRODUCT -->
	<!-- SET productInterestCount = productInterestCount + 1 -->
	<!-- WHERE productIdx = #{productIdx} -->
	<!-- </update> -->
	<!-- resulttype = roomdto. -->


	<!-- select c.useridx , p.useridx -->
	<!-- From chattingroom c -->
	<!-- innerjoin user u -->
	<!-- innerjoin product p -->
	<!-- on u.useridx = c.useridx -->
	<!-- and -->
	<!-- u.useridx = p.useridx; -->




</mapper>